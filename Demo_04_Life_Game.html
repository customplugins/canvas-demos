<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Demo 04 - Life Game on Tor</title>
	<style type="text/css">
.button{
	margin:0 20px;
	-moz-box-shadow:inset 0px 1px 0px 0px #fff6af;
	-webkit-box-shadow:inset 0px 1px 0px 0px #fff6af;
	box-shadow:inset 0px 1px 0px 0px #fff6af;
	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ffec64), color-stop(1, #ffab23) );
	background:-moz-linear-gradient( center top, #ffec64 5%, #ffab23 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffec64', endColorstr='#ffab23');
	background-color:#ffec64;
	-moz-border-radius:6px;
	-webkit-border-radius:6px;
	border-radius:6px;
	border:1px solid #ffaa22;
	display:inline-block;
	color:#333333;
	font-family:arial;
	font-size:15px;
	font-weight:bold;
	padding:6px 24px;
	text-decoration:none;
	text-shadow:1px 1px 0px #ffee66;
}.button:hover {
	background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ffab23), color-stop(1, #ffec64) );
	background:-moz-linear-gradient( center top, #ffab23 5%, #ffec64 100% );
	filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffab23', endColorstr='#ffec64');
	background-color:#ffab23;
}.button:active {
	position:relative;
	top:1px;
}

canvas {
	background: #FFF;
	border: 2px solid #FFF;
	margin-top:5px;
}
/* This imageless css button was generated by CSSButtonGenerator.com */
</style>
</head>
<body style="background: #2c2c2c;margin: 0;padding: 0;">
<div style="top: 0px;left: 0px;text-align: center;" >
	<canvas id="canvas" width="500" height="500" ></canvas>
	<div>
	
<a href="#" class="button" id="start">Start</a>
<a href="#" class="button" id="stop">Pause</a>
<a href="#" class="button" id="reset">Reset</a>

	</div>

</div>

<script type="text/javascript">
window.addEventListener('load', eventWindowLoaded, false);

function eventWindowLoaded() {
	canvasApp();
}
function canvasApp(){

	var theCanvas = document.getElementById("canvas");
	var cxt = theCanvas.getContext("2d");
	
	function clearCanvas() {
		cxt.clearRect(0,0,theCanvas.width, theCanvas.height)
	}
	
	window.Cell = function (x, y, width ) {
		this.x = x;
		this.y = y;
		this.width = width;
		this.color = Cell.deadColor;
		this.isLive = false;
		this.prevState = false;
		return this;
	}
	Cell.liveColor = '#ffff55';
	Cell.deadColor = '#302E24';
	
	Cell.prototype.draw = function(){
		cxt.save();
		cxt.fillStyle = this.color;
		cxt.fillRect( this.x * this.width, this.y * this.width, this.width, this.width );
		cxt.restore();
	}

	Cell.prototype.live = function(){
		this.isLive = true;
		this.color = Cell.liveColor;
	}
	Cell.prototype.dead = function(){
		this.isLive = false;
		this.color =  Cell.deadColor;
	}
	
	Cell.prototype.countLiveNeighbours  = function( c ){
		var count = 0, 
			x = this.x - 1,
			y = this.y - 1,
			xAxis,
			yAxis,
			cellX,
			cellY;
		
		for (yAxis = y ; yAxis <= this.y + 1; yAxis++ ) {
			for( xAxis = x; xAxis <= this.x + 1; xAxis++ ) {
				
				if( yAxis < 0 ) {
					cellY = 100 - yAxis;
				} else if ( yAxis > 99 ) {
					cellY = yAxis - 100;
				} else {
					cellY = yAxis;
				}
				
				if( xAxis < 0 ) {
					cellX = 100 - xAxis;
				} else if ( xAxis > 99 ) {
					cellX = xAxis - 100;
				} else {
					cellX = xAxis;
				}
				
				//Skip current cell
				if( cellX != this.x || cellY != this.y ) {
					if( typeof Cells[cellY] !== 'undefined' && typeof Cells[cellY][cellX] !== 'undefined' ) {
						if( Cells[cellY][cellX].prevState == true ) {
							count += 1;
						}
					}
				}
				
				
			}
			
		}
		return count;
	}
	
	Cell.prototype.deadOrLive = function(){
		var liveNeighbours = this.countLiveNeighbours()
		
		//If cell is live 
		if ( this.isLive ) {
			if( liveNeighbours == 2 || liveNeighbours == 3 ) { 
				this.live();
			} else {
				this.dead();
			}
			
		//If cell is dead
		} else {
			if( liveNeighbours === 3 ) {
				this.live();
			}else{
				this.dead();
			}
		}
		
	}
	
	
	function start(){
		
		var fieldHeight = 100,
			fieldWidth = 100,
			cellWidth = 5,
			fillingPercent = 0.3,
			fps = 15,
			randowCellsCount = fieldHeight * fieldWidth * fillingPercent,
			yAxis,
			xAxis,
			animationInterval;
		
		theCanvas.addEventListener('click',function(e){
			console.log('SELECTED CELL [' + Math.floor(e.offsetY/cellWidth) + '][' +Math.floor(e.offsetX/cellWidth)+'] ' );
		});
		
		document.getElementById("start").addEventListener('click',function(e){
			startAnimation();
		});
		document.getElementById("stop").addEventListener('click',function(e){
			stopAnimation();
		});
		document.getElementById("reset").addEventListener('click',function(e){
			reset();
		});
		
		window.Cells = [];
		
		for (yAxis = 0; yAxis < fieldHeight; yAxis+=1) {
			for (xAxis = 0; xAxis < fieldWidth; xAxis+=1) {
				if( typeof Cells[yAxis] === 'undefined' ) {
					Cells[yAxis] = [];
				}
				Cells[yAxis][xAxis] = new Cell(xAxis,yAxis,cellWidth);
			}
		}
		
		function animate() {
			
			for (yAxis = 0; yAxis < fieldHeight; yAxis+=1) {
				for (xAxis = 0; xAxis < fieldWidth; xAxis+=1) {
					
					Cells[yAxis][xAxis].prevState = Cells[yAxis][xAxis].isLive;
				}
			}
			
			
			for (yAxis = 0; yAxis < fieldHeight; yAxis+=1) {
				for (xAxis = 0; xAxis < fieldWidth; xAxis+=1) {
					
					Cells[yAxis][xAxis].deadOrLive();
				
					Cells[yAxis][xAxis].draw();
				}
			}
			
		}
		
		
		function startAnimation() {
			clearInterval(animationInterval);
			animationInterval = setInterval(function(){
				animate();
			}, 1000 * 1/fps);
			
		}
		
		function stopAnimation() {
			clearInterval(animationInterval);
		}
		
		
		function welcomeScreen(){
			cxt.fillStyle = Cell.deadColor;	
			cxt.fillRect( 0, 0, theCanvas.width, theCanvas.height );
			cxt.fillStyle = Cell.liveColor;	
			
			cxt.font = "normal normal 30px Courier";
			cxt.fillText("Convey's",  50, 200)
			cxt.font = "normal normal 75px Courier";
			cxt.fillText("Life Game", 45, 260);
		}
		
		function reset(){	
			
			clearInterval(animationInterval);
			
			for ( var i = 0; i < randowCellsCount; i++ ) {
				x = getRandomInt(0, fieldWidth - 1);
				y = getRandomInt(0, fieldHeight - 1);
				
				Cells[x][y].isLive = true;
				Cells[x][y].prevState = true;
				
			}
			
			welcomeScreen();
			
		}
		
		reset();
		
	}	
	
	start();
	
	function getRandomInt(min, max){
	  return Math.floor(Math.random() * (max - min + 1)) + min;
	}

	
}
</script>


</body>
</html>















